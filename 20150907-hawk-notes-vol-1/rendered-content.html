<p>This is the first in a series of blog posts about <a href="https://github.com/devhawk/Hawk">Hawk</a>, the engine that powers this site.
My plan is to make a post like this for every significant update to the site. We'll see well that plan works.</p>
<ul>
<li>I just pushed out a new version of Hawk on my website. The primary feature of this release is support for
<a href="http://blogs.msdn.com/b/webdev/archive/2015/09/02/announcing-availability-of-asp-net-5-beta7.aspx">ASP.NET 5 Beta 7</a>.
I also published the <a href="https://github.com/devhawk/Hawk">source code</a> up on GitHub. Feedback welcome!</li>
<li>As I mentioned in <a href="/blog/2015/09/02/the-brilliant-magic-of-edgejs">my post on Edge.js</a>, the publishing tools
for Hawk is little more than duct tape and bailing wire at this point. Eventually, I'd like to have a
dedicated tool, but for now it's a manual three step process:
<ol>
<li>Run the <a href="https://github.com/devhawk/Hawk/tree/master/src/PublishDraft">PublishDraft</a> to publish a post from
my draft directory to a local git repo of all my content. As part of this, I update some of the metadata and
render the markdown to HTML.</li>
<li>Run my <a href="https://github.com/devhawk/Hawk/blob/master/src/Hawk/CustomCommands.cs#L79">WritePostsToAzure Custom Command</a>
to publish posts from my local git repo to Azure. I have a blog post on my custom command
infrastructure in the works.</li>
<li>Trigger a content refresh via an <a href="https://github.com/devhawk/Hawk/blob/ae0431ffc0a816a218f00e4c1815adbe95e445f1/src/Hawk/Controllers/HomeController.cs#L50">unpublished URL</a>.</li>
</ol>
</li>
<li>I need to trigger a content refresh because Hawk loads all of the post metadata from Azure on startup.
The combined metadata for all my posts is pretty small - about 2/3 of a megabyte stored on disk as JSON.
Having the data in memory makes it easy to query as well as support multiple post repositories (
<a href="https://github.com/devhawk/Hawk/blob/master/src/Hawk/Services/AzureRepo.cs">Azure storage</a> and the
<a href="https://github.com/devhawk/Hawk/blob/master/src/Hawk/Services/FileSystemRepo.cs">file system</a>).</li>
<li>I felt comfortable publishing the Hawk source code now because I added a secret key
to the data refresh URL. Previously, the refresh URL was unsecured. I didn't think giving
random, anonymous people on the Interet the ability to kick off a data refresh was a
good idea, so I held off publishing source until I secured that endpoint.</li>
<li>Hawk caches blog post content and legacy comments <a href="https://github.com/aspnet/Caching/tree/dev/src/Microsoft.Framework.Caching.Memory">in memory</a>.
This release also adds cache invalidation logic so that everything gets reloaded
from storage on data refresh, not just the blog post metadata.</li>
<li>I don't understand what the ASP.NET team is doing with the BufferedHtmlContent class.
In beta 7 it's <a href="https://github.com/aspnet/Common/blob/dev/src/Microsoft.Framework.BufferedHtmlContent.Sources/BufferedHtmlContent.cs">been moved</a>
to the Common repo and <a href="https://www.myget.org/F/aspnetmaster/api/v2/package/Microsoft.Framework.BufferedHtmlContent.Sources/1.0.0-beta7">published as source</a>.
However, I couldn't get it to compile because it depends on an <a href="https://github.com/aspnet/Common/blob/dev/src/Microsoft.Framework.BufferedHtmlContent.Sources/BufferedHtmlContent.cs#L119">internal <code>[NotNull]</code>
attribute</a>.
I decided to scrap my use of BufferedHtmlContent and built out several classes that
implement <code>IHtmlContent</code> directly instead. For example, the links at the bottom
of my master layout are rendered by the <a href="https://github.com/devhawk/Hawk/blob/master/src/Hawk/Views/Shared/_Layout.cshtml#L7">SocialLink class</a>.
Frankly, I'm not sure if rolling your own  <code>IHtmlContent</code> class for snippet
of HTML code you want to automate is a best practice. It seems like it's harder than
it should be. It feels like ASP.NET needs a built-in class like BufferedHtmlContent,
so I'm not sure why it's been removed.</li>
</ul>
