<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">                          
<!--<![endif]-->

			<head>
		    <meta charset="UTF-8" />
		    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE" />
		    <title>Monadic Philosophy Part 3 &#8211; The Parser Monad in C# | DevHawk</title>
		    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
		    <link rel="profile" href="http://gmpg.org/xfn/11" />
		    <link rel="pingback" href="http://devhawk.net/xmlrpc.php" />
		   
		   <!-- Icons font support for IE6-7  -->
		    <!--[if lt IE 8]>
		      <script src="http://devhawk.net/wp-content/themes/customizr/inc/css/fonts/lte-ie7.js"></script>
		    <![endif]-->
		    <link rel="alternate" type="application/rss+xml" title="DevHawk &raquo; Feed" href="http://devhawk.net/feed/" />
<link rel="alternate" type="application/rss+xml" title="DevHawk &raquo; Comments Feed" href="http://devhawk.net/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="DevHawk &raquo; Monadic Philosophy Part 3 &#8211; The Parser Monad in C# Comments Feed" href="http://devhawk.net/2008/07/31/monadic-philosophy-part-3-the-parser-monad-in-c/feed/" />
<link rel='stylesheet' id='jetpack-subscriptions-css'  href='http://devhawk.net/wp-content/plugins/jetpack/modules/subscriptions/subscriptions.css?ver=3.8.1' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-widgets-css'  href='http://devhawk.net/wp-content/plugins/jetpack/modules/widgets/widgets.css?ver=20121003' type='text/css' media='all' />
<link rel='stylesheet' id='customizr-skin-css'  href='http://devhawk.net/wp-content/themes/customizr/inc/css/blue.css?ver=3.1.6' type='text/css' media='all' />
<link rel='stylesheet' id='customizr-style-css'  href='http://devhawk.net/wp-content/themes/customizr/style.css?ver=3.1.6' type='text/css' media='all' />
<link rel='stylesheet' id='fancyboxcss-css'  href='http://devhawk.net/wp-content/themes/customizr/inc/js/fancybox/jquery.fancybox-1.3.4.min.css?ver=3.8.1' type='text/css' media='all' />
<script type='text/javascript' src='http://devhawk.net/wp-includes/js/jquery/jquery.js?ver=1.10.2'></script>
<script type='text/javascript' src='http://devhawk.net/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://devhawk.net/wp-includes/js/comment-reply.min.js?ver=3.8.1'></script>
<script type='text/javascript' src='http://devhawk.net/wp-content/themes/customizr/inc/js/modernizr.min.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://devhawk.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://devhawk.net/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='IPy Post 2.0 Roadmap Clarifications' href='http://devhawk.net/2008/07/30/ipy-post-2-0-roadmap-clarifications/' />
<link rel='next' title='McCain&#8217;s Dick Move of the Week' href='http://devhawk.net/2008/08/01/mccains-dick-move-of-the-week/' />
<meta name="generator" content="WordPress 3.8.1" />
<link rel='canonical' href='http://devhawk.net/2008/07/31/monadic-philosophy-part-3-the-parser-monad-in-c/' />
<link rel='shortlink' href='http://wp.me/p1uVhd-iN' />
	
<!-- START: Syntax Highlighter ComPress -->
<script type="text/javascript" src="http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shCore.js"></script>
<script type="text/javascript" src="http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shAutoloader.js"></script>
<link type="text/css" rel="stylesheet" href="http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/styles/shCoreDefault.css"/>
<!-- END: Syntax Highlighter ComPress -->

  
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Monadic Philosophy Part 3 - The Parser Monad in C#" />
<meta property="og:url" content="http://devhawk.net/2008/07/31/monadic-philosophy-part-3-the-parser-monad-in-c/" />
<meta property="og:description" content="(If you disregarded my advice and read the previous version of this post, please note I rewrote this post significantly so you&#039;ll probably want to read it again.)In the last post, we looked at how ..." />
<meta property="article:published_time" content="2008-08-01T03:47:30+00:00" />
<meta property="article:modified_time" content="2011-04-17T05:15:10+00:00" />
<meta property="article:author" content="http://devhawk.net/author/admin/" />
<meta property="og:site_name" content="DevHawk" />
<meta property="og:image" content="http://wordpress.com/i/blank.jpg" />
<meta name="twitter:site" content="@jetpack" />
<meta name="twitter:card" content="summary" />

	<!-- Clean Archives Reloaded v3.2.0 | http://www.viper007bond.com/wordpress-plugins/clean-archives-reloaded/ -->
	<style type="text/css">.car-collapse .car-yearmonth { cursor: s-resize; } </style>
	<script type="text/javascript">
		/* <![CDATA[ */
			jQuery(document).ready(function() {
				jQuery('.car-collapse').find('.car-monthlisting').hide();
				jQuery('.car-collapse').find('.car-monthlisting:first').show();
				jQuery('.car-collapse').find('.car-yearmonth').click(function() {
					jQuery(this).next('ul').slideToggle('fast');
				});
				jQuery('.car-collapse').find('.car-toggler').click(function() {
					if ( 'Expand All' == jQuery(this).text() ) {
						jQuery(this).parent('.car-container').find('.car-monthlisting').show();
						jQuery(this).text('Collapse All');
					}
					else {
						jQuery(this).parent('.car-container').find('.car-monthlisting').hide();
						jQuery(this).text('Expand All');
					}
					return false;
				});
			});
		/* ]]> */
	</script>


        
        
        		    <!--Icons size hack for IE8 and less -->
		    <!--[if lt IE 9]>
		      <link href="http://devhawk.net/wp-content/themes/customizr/inc/css/fonts/ie8-hacks.css" rel="stylesheet" type="text/css"/>
		    <![endif]-->
		</head>
		
	<body class="single single-post postid-1165 single-format-standard" itemscope itemtype="http://schema.org/WebPage">
		
		
	   	<header class="tc-header clearfix row-fluid" role="banner">
			
			
		
	    	
	        <div class="brand span3 pull-left">

	        	<h1><a class="site-title" href="http://devhawk.net/" title="DevHawk | Passion * Technology * Ruthless Competence">DevHawk</a></h1>
	        </div> <!-- brand span3 pull-left -->

	        
	   
	   
	   <div class="container outside"><h2 class="site-description">Passion * Technology * Ruthless Competence</h2></div>
      	<div class="navbar-wrapper clearfix span9">

      		<div class="navbar notresp row-fluid pull-left">
      			<div class="navbar-inner" role="navigation">
      				<div class="row-fluid">
            			<div class="social-block span5"><a class="social-icon icon-feed" href="http://devhawk.net/feed/rss/" title="Suscribe to my rss feed"  ></a><a class="social-icon icon-twitter" href="http://twitter.com/devhawk" title="Follow me on Twitter" target=_blank ></a><a class="social-icon icon-facebook" href="http://facebook.com/devhawk" title="Follow me on Facebook" target=_blank ></a><a class="social-icon icon-github" href="http://github.com/devhawk" title="Follow me on Github" target=_blank ></a><a class="social-icon icon-linkedin" href="http://www.linkedin.com/in/harrypierson" title="Follow me on LinkedIn" target=_blank ></a></div><h2 class="span7 inside site-description">Passion * Technology * Ruthless Competence</h2><div class="nav-collapse collapse tc-hover-menu-wrapper"><div class="menu-mainmenu-container"><ul id="menu-mainmenu" class="nav tc-hover-menu"><li id="menu-item-1862" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1862"><a href="http://devhawk.net/">Home</a></li>
<li id="menu-item-1562" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1562"><a href="http://devhawk.net/archives/">Archives</a></li>
<li id="menu-item-1564" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1564"><a href="http://devhawk.net/category/architecture/">Architecture</a></li>
<li id="menu-item-1565" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1565"><a href="http://devhawk.net/category/development/">Development</a></li>
<li id="menu-item-1561" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1561"><a href="http://www.zazzle.com/harrypierson*">DevHawk Designs</a></li>
</ul></div></div>            		</div><!-- .row-fluid -->
            	</div><!-- /.navbar-inner -->
            </div><!-- /.navbar notresp -->

            <div class="navbar resp">
            	<div class="navbar-inner" role="navigation">
            		<div class="social-block "><a class="social-icon icon-feed" href="http://devhawk.net/feed/rss/" title="Suscribe to my rss feed"  ></a><a class="social-icon icon-twitter" href="http://twitter.com/devhawk" title="Follow me on Twitter" target=_blank ></a><a class="social-icon icon-facebook" href="http://facebook.com/devhawk" title="Follow me on Facebook" target=_blank ></a><a class="social-icon icon-github" href="http://github.com/devhawk" title="Follow me on Github" target=_blank ></a><a class="social-icon icon-linkedin" href="http://www.linkedin.com/in/harrypierson" title="Follow me on LinkedIn" target=_blank ></a></div><h2 class="span7 inside site-description">Passion * Technology * Ruthless Competence</h2><button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="nav-collapse collapse tc-hover-menu-wrapper"><div class="menu-mainmenu-container"><ul id="menu-mainmenu-1" class="nav tc-hover-menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1862"><a href="http://devhawk.net/">Home</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1562"><a href="http://devhawk.net/archives/">Archives</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1564"><a href="http://devhawk.net/category/architecture/">Architecture</a></li>
<li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-1565"><a href="http://devhawk.net/category/development/">Development</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1561"><a href="http://www.zazzle.com/harrypierson*">DevHawk Designs</a></li>
</ul></div></div>            	</div><!-- /.navbar-inner -->
      		</div><!-- /.navbar resp -->

    	</div><!-- /.navbar-wrapper -->

        
		</header>

		<div id="main-wrapper" class="container">

    <div class="breadcrumb-trail breadcrumbs" itemprop="breadcrumb"><span class="trail-begin"><a href="http://devhawk.net" title="DevHawk" rel="home" class="trail-begin">Home</a></span> <span class="sep">&raquo;</span> <a href="http://devhawk.net/2008/" title="2008">2008</a> <span class="sep">&raquo;</span> <a href="http://devhawk.net/2008/07/" title="July 2008">July</a> <span class="sep">&raquo;</span> <a href="http://devhawk.net/2008/07/31/" title="July 31, 2008">31</a> <span class="sep">&raquo;</span> <span class="trail-end">Monadic Philosophy Part 3 &#8211; The Parser Monad in C#</span></div><div class="tc-hot-crumble container" role="navigation"><div class="row"><div class="span12"></div></div></div>    
    <div class="container" role="main">
        <div class="row">

                            
                <div id="content" class="span9 article-container">
                    
                    
                        
                                                                                    
                                                                    <article id="post-1165" class="post-1165 post type-post status-publish format-standard hentry category-development tag-c-sharp tag-f-sharp tag-functional-programming tag-monads row-fluid">
                                        
        <header class="entry-header">
          
          <h1 class="entry-title format-icon">Monadic Philosophy Part 3 &#8211; The Parser Monad in C#  </h1>
        <div class="entry-meta">
            This entry was posted in <a class="btn btn-mini" href="http://devhawk.net/category/development/" title="View all posts in Development"> Development </a> and tagged <a class="btn btn-mini btn-tag" href="http://devhawk.net/tag/c-sharp/" title="View all posts in C#"> C# </a><a class="btn btn-mini btn-tag" href="http://devhawk.net/tag/f-sharp/" title="View all posts in F#"> F# </a><a class="btn btn-mini btn-tag" href="http://devhawk.net/tag/functional-programming/" title="View all posts in Functional Programming"> Functional Programming </a><a class="btn btn-mini btn-tag" href="http://devhawk.net/tag/monads/" title="View all posts in Monads"> Monads </a> on <a href="http://devhawk.net/2008/07/31/" title="8:47 pm" rel="bookmark"><time class="entry-date" datetime="2008-07-31T20:47:30+00:00">July 31, 2008</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="http://devhawk.net/author/admin/" title="View all posts by DevHawk" rel="author">DevHawk</a></span></span>.
        </div><!-- .entry-meta -->

        <hr class="featurette-divider __before_content">
        </header><!-- .entry-header -->

          

        <section class="entry-content ">
            <p>(If you disregarded <a href="http://devhawk.net/2008/07/30/Pushed+The+Wrong+Button.aspx">my advice</a> and read the previous version of this post, please note I rewrote this post significantly so you&#8217;ll probably want to read it again.)</p>
<p>In the <a href="http://devhawk.net/2008/07/30/Monadic+Philosophy+Part+2+The+LINQ+Monad.aspx">last post</a>, we looked at how LINQ is a monad and how IEnumerable is a pseudo-functional construct. However, C#&#8217;s intrinsic collection support &#8211; aka foreach and yield return &#8211; really obscure how you might go about building your own monad. So for this post, we&#8217;re going to take a look at a parsing monad instead. Just as LINQ broke the big problem of queries into a collection of standard query operators that were composable, we want to take the same approach for parsers. </p>
<p>Note, I&#8217;m going to stick with C# for now, and get into F# monads in my next post. Quick shout out to <a href="http://blogs.msdn.com/lukeh/archive/2007/08/19/monadic-parser-combinators-using-c-3-0.aspx">Luke Hoban</a> and <a href="http://lorgonblog.spaces.live.com/blog/cns!701679AD17B6D310!124.entry">Brian McNamara</a>, from whom I <strike>stole</strike> obtained some of the code below.</p>
<p>Quick refresher: I&#8217;ve described a monad as a sequence of computations with a context flow. Since C# has explicit sequencing, we want to focus on the context flow. For LINQ, the context was IEnumerable. For parsers, we could define an similar IParser interface like this:</p>
<pre class="brush: csharp">
class Tuple&lt;T1, T2&gt; 
{ 
    public readonly T1 Item1; 
    public readonly T2 Item2; 
    public Tuple(T1 val1, T2 val2) { Item1 = val1; Item2 = val2; } 
} 

class Result&lt;T&gt; : Tuple&lt;T, string&gt; 
{ 
    public Result(T val, string rest) : base(val, rest) { } 
} 

interface IParser&lt;T&gt; 
{ 
    Result&lt;T&gt; Parse(string input); 
}
</pre>
<p>The Parse function takes a string to be parsed as input and returns the parsing result which pairs the semantic value with with the remaining string input to be parsed. I&#8217;ve built out a simple generic tuple class because I know I&#8217;ll use it again later. I&#8217;ve <a href="http://devhawk.net/2006/08/22/Language+Features+I+Wish+C+Had+Tuples.aspx">long wished</a> C# would support intrinsic tuples like F# does. For convenience, I&#8217;ve also created a strongly typed subclass of Tuple to represent parse results where the second item is a string, to save some typing. Since Result is a class, it can be null which means the the Parser failed to parse the input. </p>
<p>The problem with this approach is that unlike IEnumerable, the C# compiler has no built-in knowledge of this interface. That means there are no easy-to-use keywords like foreach and yield return that can do our heavy lifting of consuming or creating these IParser types for us. Instead, we would have to explicitly declare classes to implement the interface. As we add more and more parsers, that additional overhead of creating types would become more and more unwieldy. Instead, let&#8217;s redefine Parser as a delegate.</p>
<pre class="brush: csharp">
delegate Result&lt;T&gt; Parser&lt;T&gt;(string input);
</pre>
<p>The benefit of this approach is that you can create Parser delegates inside functions, using C#&#8217;s anonymous delegate syntax, without the overhead of creating a type. For example, here&#8217;s a function to create a simple primitive parser that strips the first character off the parse string and returns it as the parse result:</p>
<pre class="brush: csharp">
static Parser&lt;char&gt; Item() 
{ 
    return input =&gt; 
        { 
            return string.IsNullOrEmpty(input) 
                ? null
                : new Result&lt;char&gt;(input[0], input.Substring(1)); 
        }; 
}
</pre>
<p>That&#8217;s a lot more convenient than building a type just to implement a single method. </p>
<p>Now that we have our Parser type, we need to think about how to compose Parsers so that we can flow context between them. Much as LINQ provides a collection of primitive query operators (Select, Where, OrderBy, etc), you would expect a monadic parser library to provide a collection of primitive parsers (Item, Satisfy, AnyOf, ItemEqual, etc), that you could combine into higher-order parsers along with some language specific lower-order parsers. Here&#8217;s an example from the the <a href="http://pdos.csail.mit.edu/~baford/packrat/popl04/peg-popl04.pdf">PEG grammar</a>:</p>
<p>    Primary &lt;- Identifier !LEFTARROW / OPEN Expression CLOSE / Literal / Class / DOT</p>
<p>The Primary parser depends on some high-order language specific parsers (Identifier, Expression, Literal and Class) as well as some language specific low-order tokenizer style parsers (LEFTARROW, OPEN, CLOSE and DOT) and finally some language-independent primitive parsers (the failure predicate ! and the prioritized choice operator /). </p>
<p>So how should we compose these various Parsers? LINQ query operators were fairly easy to compose because they all take in and return the same type (IEnumerable) so you can simply chain them together. Parsers are a little trickier because the inputs and outputs are asymmetric &#8211; i.e. they take a string, but return a Result &#8211; so simple chaining won&#8217;t work. </p>
<p>We could combine the parsers sequentially, taking the parse string returned from first parser and feed it into the second. Then we could combine the two parse values in a Tuple to return them (you see why I created a generic Tuple class?) resulting in a function that looks like this:</p>
<pre class="brush: csharp">
static Parser&lt;Tuple&lt;T1,T2&gt;&gt; Join&lt;T1,T2&gt;(this Parser&lt;T1&gt; p1, Parser&lt;T2&gt; p2)  
{  
    return input =&gt;  
        {  
            var ret1 = p1(input);  
            if (ret1 == null)  
                return null;  

            var ret2 = p2(ret1.Item2);  
            if (ret2 == null)  
                return null;  

            return new Result&lt;Tuple&lt;T1,T2&gt;&gt;(  
                new Tuple&lt;T1, T2&gt;(ret1.Item1, ret2.Item1),  
                ret2.Item2);  
        };  
}
</pre>
<p>Note this is an extension method so we can call Parser1.Join(Parser2) rather than the less fluent Join(Parser1, Parser2). I was going to call this function Combine, but there&#8217;s already a static Combine method on the Delegate type that caused a conflict, so I used Join instead. </p>
<p>The Join approach works, but it&#8217;s a bit unwieldy to return the parsing values in a tuple. Every set of joined parsers will result in another level of tuple nesting in the Result that&#8217;s returned. That gets pretty ugly pretty fast. For example, lets say we want to create a parser that combines two instances of Item. It looks like this:</p>
<pre class="brush: csharp">
static Parser&lt;Tuple&lt;char, char&gt;&gt; TwoItems() 
{ 
    return Item().Plus(Item()); 
}
</pre>
<p>That&#8217;s not so bad. But now look what happens if we combine the TwoItems parser with another instance of Item:</p>
<pre class="brush: csharp">
static Parser&lt;Tuple&lt;Tuple&lt;char, char&gt;, char&gt;&gt; ThreeItems() 
{ 
    return TwoItems().Plus(Item()); 
}
</pre>
<p>The result is a nested tuple. Yuck. We need a better way. Enter the monadic bind. The code looks like this:</p>
<pre class="brush: csharp">
static Parser&lt;U&gt; Bind&lt;T, U&gt;(this Parser&lt;T&gt; p1, Func&lt;T, Parser&lt;U&gt;&gt; fun) 
{ 
    return input =&gt; 
        { 
            var ret1 = p1(input); 
            if (ret1 == null) 
                return null; 

            var p2 = fun(ret1.Item1); 
            if (p2 == null) 
                return null; 

            return p2(ret1.Item2); 
        }; 
}
</pre>
<p>Like the Join function above, Bind starts by calling the first parser function, returning null if the parse fails. However, instead of calling to the second parser directly, it calls to the provided function that generates the second parser. This function acts as a <a href="http://en.wikipedia.org/wiki/Closure_%28computer_science%29">closure</a>, packaging up the parse value from the first parser for later processing. Finally, Bind calls to the generated second parser, feeding in the remaining text from the first parser result. </p>
<p>This approach allows you to inject code that combines the parsing values however we like rather than always pairing them up in a tuple. Here&#8217;s a version of TwoItems that binds a call to Item with a custom function that calls Item again and returns the two characters as a string rather than a tuple:</p>
<pre class="brush: csharp">
static Parser&lt;string&gt; BetterTwoItems() 
{ 
    return Item().Bind&lt;char, string&gt;( 
        val =&gt;  
        { 
            return input =&gt; 
            { 
                var result = Item()(input); 
                return new Result&lt;string&gt;( 
                    string.Format("{0}{1}", val, result.Item1), 
                    result.Item2); 
            }; 
        }); 
}
</pre>
<p>It&#8217;s kinda strange to see a lambda expression that returns a lambda expression in C#, but that&#8217;s what this code does. The first lambda expression (val =&gt;) defines the custom function, the second lambda expression (input =&gt;) defines the Parser delegate. Val is the parse value from calling Item() the first time &#8211; ret1.Item1 in the Bind function above. Input is the remainder of the parse string &#8211; ret1.Item2 from the Bind function. </p>
<p>Unfortunately, while this approach avoids nested tuples for parse values, we&#8217;ve had to give up quite a bit of simplicity. The original TwoItems method was a single line of code. BetterTwoItems is significantly more complex. Furthermore, the double lambda expression syntax confuses C#&#8217;s type inference, forcing you to explicitly specify the generic types on the Bind method. Luckily there&#8217;s a better way to write this. However, let&#8217;s start by rewriting the function like this:</p>
<pre class="brush: csharp">
static Parser&lt;string&gt; SlightlyBetterTwoItems() 
{ 
    return Item().Bind( 
        v1 =&gt; Item().Bind&lt;char, string&gt;( 
            v2 =&gt; 
            { 
                return input =&gt; 
                { 
                    return new Result&lt;string&gt;( 
                        string.Format("{0}{1}", v1, v2), 
                        input); 
                }; 
            })); 
}
</pre>
<p>SlightlyBetterTwoItems pulls the second call to Item out into a second Bind operation. The point of this refactoring is to make it clear that we can view this function as a call to Item, bound to a second call to Item, bound to custom function to return a Parser that returns the two parse value chars formatted as a string. You&#8217;ll notice that by eliminating the the double lambda expression on the first call to Bind, we were able to drop out the explicit generic type specification. </p>
<p>This version is a little clearer, but we can make it clearer yet. It turns out that wrapping up a parse value in a Parser that unconditionally returns the parse value and the parse text input in a Result is a very common operation. So let&#8217;s create a primitive function Result to wrap up a parse value in a Parser delegate and build our final version of TwoItems that uses it.</p>
<pre class="brush: csharp">
static Parser&lt;T&gt; Result&lt;T&gt;(T val)  
{  
    return input =&gt; new Result&lt;T&gt;(val, input);  
}  

static Parser&lt;string&gt; BestTwoItems() 
{ 
    return Item().Bind( 
        v1 =&gt; Item().Bind( 
        v2 =&gt; Result(string.Format("{0}{1}", v1, v2)))); 
}
</pre>
<p>Now it&#8217;s very clear that we have a call to Item, bound to a second call to item, which is in turn bound to a call to Result. We&#8217;ve now dropped all use of double lambdas, which means C# can infer the types to each of our Bind calls implicitly. But more importantly, do you see <em>any</em> reference to Parser&lt;T&gt; delegates or input strings in this code? Only in the return type specification. Just as LINQ hides the specifics of flowing IEnumerable or enumerator objects between standard query operators, the parser monad hides the specifics of flowing Parser delegates or input strings between parse operations. </p>
<p>The Parser delegate plus the Bind and Result methods are all there are to our basic parser monad. Seriously, all that worry that monad &#8220;is a bit obscure and sounds a little daunting&#8221; and it&#8217;s really just two functions and a delegate type. </p>
<p>While this code is fairly straight forward, the whole nested lambdas expressions is fairly atypical syntax that some developers might have a hard time understanding. Unfortunately, if we&#8217;re writing our parsers in C#, we&#8217;re kinda stuck with this syntax. However, F# has a special syntax that lets you write what looks like normal sequential code, while still flowing the Parser context between parse operations exactly like the code above does. We&#8217;ll take a look at that syntax in the next post.</p>
                    </section><!-- .entry-content -->

                                          </article>
                                
                            
                        
                    
	<hr class="featurette-divider __after_loop">

<div id="comments" class="comments-area">
	
			
	
		<h2 id="tc-comment-title" class="comments-title">2 thoughts on &ldquo;<span>Monadic Philosophy Part 3 &#8211; The Parser Monad in C#</span>&rdquo;</h2>    
            <ul class="commentlist">
                    <li class="comment even thread-even depth-1" id="li-comment-2107">
        
          <article class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://0.gravatar.com/avatar/67b5d13405bc2ba4ccba05d8a0e92c2b?s=80&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D80&amp;r=G' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn"><a href='http://elder_george.livejournal.com' rel='external nofollow' class='url'>Yuri K.</a>  </cite> <a class="comment-date" href="http://devhawk.net/2008/07/31/monadic-philosophy-part-3-the-parser-monad-in-c/#comment-2107"><time datetime="2008-07-31T22:53:47+00:00">July 31, 2008 at 10:53 pm</time></a></header>  <section class="comment-content comment"><p>Well, we apparently aren&#8217;t stuck with &#8216;nested lambda syntax&#8217; in C#, since it has more nice &#8216;from-select&#8217; syntax the (ab)use of which Luke Hoban has shown in the post you referenced.<br />
But of course, F# sugar for monads is much sweeter =)</p>
</section></div></div></article>        <!-- #comment-## -->
      </li><!-- #comment-## -->
      <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2108">
        
          <article class="comment"><div class="row-fluid"><div class="comment-avatar span2"><img alt='' src='http://1.gravatar.com/avatar/56ec7ec88534583795e9086eaec1635b?s=80&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D80&amp;r=G' class='avatar avatar-80 photo' height='80' width='80' /></div><div class="span10"> <header class="comment-meta comment-author vcard"><cite class="fn">DevHawk  </cite> <a class="comment-date" href="http://devhawk.net/2008/07/31/monadic-philosophy-part-3-the-parser-monad-in-c/#comment-2108"><time datetime="2008-08-01T12:58:11+00:00">August 1, 2008 at 12:58 pm</time></a></header>  <section class="comment-content comment"><p>Yeah, there&#8217;s not a direct match between Bind and Result as I defined them and C#&#8217;s Query comprehension syntax, so I decided to skip discussing Luke&#8217;s post (for now). But as you rightly point out, F#&#8217;s monadic syntax rocks (as we&#8217;ll see in my next post!)</p>
</section></div></div></article>        <!-- #comment-## -->
      </li><!-- #comment-## -->
            </ul><!-- .commentlist -->

          <p class="nocomments">Comments are closed.</p>
	
</div><!-- #comments .comments-area -->
      
        <hr class="featurette-divider __after_loop">
        <nav id="nav-below" class="navigation" role="navigation">

            <h3 class="assistive-text">
              Post navigation            </h3>

            <ul class="pager">
                              <li class="previous">
                  <span class="nav-previous">
                    <a href="http://devhawk.net/2008/07/30/ipy-post-2-0-roadmap-clarifications/" rel="prev"><span class="meta-nav">&larr;</span> IPy Post 2.0 Roadmap Clarifications</a>                  </span>
                </li>
                                            <li class="next">
                  <span class="nav-next">
                    <a href="http://devhawk.net/2008/08/01/mccains-dick-move-of-the-week/" rel="next">McCain&#8217;s Dick Move of the Week <span class="meta-nav">&rarr;</span></a>                  </span>
                </li>
                          </ul>

        </nav><!-- #nav-below .navigation -->

      
      
                </div><!--.article-container -->

                  
      <div class="span3 right tc-sidebar">
         <div id="right" class="widget-area" role="complementary">
                                             <aside id="text-3" class="widget widget_text"><h3 class="widget-title">Our Sponsors</h3>			<div class="textwidget"><div align=center data-type="ad" data-publisher="lqm.devhawk.site" data-zone="ron" data-format="160x600" data-tags="windows%2C%20windows%208%2C%20windows%20runtime%2C%20JavaScript%2C%20C%23%2C%20CLR%2C%20C%2B%2B"></div></div>
		</aside><aside id="categories-2" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-177"><a href="http://devhawk.net/category/architecture/" title="View all posts filed under Architecture">Architecture</a>
</li>
	<li class="cat-item cat-item-204"><a href="http://devhawk.net/category/development/" title="View all posts filed under Development">Development</a>
</li>
	<li class="cat-item cat-item-223"><a href="http://devhawk.net/category/general-geekery/" title="View all posts filed under General Geekery">General Geekery</a>
</li>
	<li class="cat-item cat-item-252"><a href="http://devhawk.net/category/ironpython/" title="View all posts filed under IronPython">IronPython</a>
</li>
	<li class="cat-item cat-item-180"><a href="http://devhawk.net/category/morning-coffee/" title="View all posts filed under Morning Coffee">Morning Coffee</a>
</li>
	<li class="cat-item cat-item-352"><a href="http://devhawk.net/category/personal/" title="View all posts filed under Personal">Personal</a>
</li>
	<li class="cat-item cat-item-219"><a href="http://devhawk.net/category/politics/" title="View all posts filed under Politics">Politics</a>
</li>
	<li class="cat-item cat-item-234"><a href="http://devhawk.net/category/sports/" title="View all posts filed under Sports">Sports</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://devhawk.net/category/uncategorized/" title="View all posts filed under Uncategorized">Uncategorized</a>
</li>
	<li class="cat-item cat-item-283"><a href="http://devhawk.net/category/windows/" title="View all posts filed under Windows">Windows</a>
</li>
	<li class="cat-item cat-item-357"><a href="http://devhawk.net/category/windows-runtime/" title="View all posts filed under Windows Runtime">Windows Runtime</a>
</li>
		</ul>
</aside><aside id="tag_cloud-4" class="widget widget_tag_cloud"><h3 class="widget-title">Tags</h3><div class="tagcloud"><a href='http://devhawk.net/tag/asp-net/' class='tag-link-178' title='27 topics' style='font-size: 13.466666666667pt;'>ASP.NET</a>
<a href='http://devhawk.net/tag/blogging/' class='tag-link-184' title='122 topics' style='font-size: 22pt;'>Blogging</a>
<a href='http://devhawk.net/tag/c-sharp/' class='tag-link-235' title='17 topics' style='font-size: 10.933333333333pt;'>C#</a>
<a href='http://devhawk.net/tag/college-football/' class='tag-link-194' title='10 topics' style='font-size: 8pt;'>College Football</a>
<a href='http://devhawk.net/tag/community/' class='tag-link-213' title='81 topics' style='font-size: 19.6pt;'>Community</a>
<a href='http://devhawk.net/tag/dasblog/' class='tag-link-303' title='12 topics' style='font-size: 8.9333333333333pt;'>dasBlog</a>
<a href='http://devhawk.net/tag/database/' class='tag-link-214' title='13 topics' style='font-size: 9.4666666666667pt;'>Database</a>
<a href='http://devhawk.net/tag/debugger/' class='tag-link-279' title='23 topics' style='font-size: 12.533333333333pt;'>Debugger</a>
<a href='http://devhawk.net/tag/dlr/' class='tag-link-231' title='25 topics' style='font-size: 12.933333333333pt;'>DLR</a>
<a href='http://devhawk.net/tag/domain-specific-languages/' class='tag-link-208' title='15 topics' style='font-size: 10.133333333333pt;'>Domain Specific Languages</a>
<a href='http://devhawk.net/tag/dynamic-languages/' class='tag-link-217' title='12 topics' style='font-size: 8.9333333333333pt;'>Dynamic Languages</a>
<a href='http://devhawk.net/tag/entertainment/' class='tag-link-196' title='14 topics' style='font-size: 9.8666666666667pt;'>Entertainment</a>
<a href='http://devhawk.net/tag/etech/' class='tag-link-297' title='15 topics' style='font-size: 10.133333333333pt;'>ETech</a>
<a href='http://devhawk.net/tag/f-sharp/' class='tag-link-198' title='51 topics' style='font-size: 17.066666666667pt;'>F#</a>
<a href='http://devhawk.net/tag/family/' class='tag-link-179' title='33 topics' style='font-size: 14.533333333333pt;'>Family</a>
<a href='http://devhawk.net/tag/functional-programming/' class='tag-link-202' title='18 topics' style='font-size: 11.2pt;'>Functional Programming</a>
<a href='http://devhawk.net/tag/games/' class='tag-link-185' title='18 topics' style='font-size: 11.2pt;'>Games</a>
<a href='http://devhawk.net/tag/hockey/' class='tag-link-215' title='33 topics' style='font-size: 14.533333333333pt;'>Hockey</a>
<a href='http://devhawk.net/tag/ironruby/' class='tag-link-253' title='16 topics' style='font-size: 10.533333333333pt;'>IronRuby</a>
<a href='http://devhawk.net/tag/lanugages/' class='tag-link-229' title='43 topics' style='font-size: 16pt;'>Lanugages</a>
<a href='http://devhawk.net/tag/linq/' class='tag-link-224' title='24 topics' style='font-size: 12.8pt;'>LINQ</a>
<a href='http://devhawk.net/tag/microsoft/' class='tag-link-232' title='31 topics' style='font-size: 14.266666666667pt;'>Microsoft</a>
<a href='http://devhawk.net/tag/modelling/' class='tag-link-225' title='61 topics' style='font-size: 18pt;'>Modelling</a>
<a href='http://devhawk.net/tag/movies/' class='tag-link-218' title='23 topics' style='font-size: 12.533333333333pt;'>Movies</a>
<a href='http://devhawk.net/tag/music/' class='tag-link-248' title='20 topics' style='font-size: 11.733333333333pt;'>Music</a>
<a href='http://devhawk.net/tag/p2p/' class='tag-link-325' title='11 topics' style='font-size: 8.5333333333333pt;'>P2P</a>
<a href='http://devhawk.net/tag/parsing-expression-grammar/' class='tag-link-209' title='16 topics' style='font-size: 10.533333333333pt;'>Parsing Expression Grammar</a>
<a href='http://devhawk.net/tag/powershell/' class='tag-link-230' title='40 topics' style='font-size: 15.6pt;'>PowerShell</a>
<a href='http://devhawk.net/tag/rest/' class='tag-link-181' title='18 topics' style='font-size: 11.2pt;'>REST</a>
<a href='http://devhawk.net/tag/ruby/' class='tag-link-190' title='23 topics' style='font-size: 12.533333333333pt;'>Ruby</a>
<a href='http://devhawk.net/tag/service-broker/' class='tag-link-320' title='14 topics' style='font-size: 9.8666666666667pt;'>Service Broker</a>
<a href='http://devhawk.net/tag/silverlight/' class='tag-link-200' title='20 topics' style='font-size: 11.733333333333pt;'>Silverlight</a>
<a href='http://devhawk.net/tag/soa/' class='tag-link-183' title='94 topics' style='font-size: 20.533333333333pt;'>SOA</a>
<a href='http://devhawk.net/tag/software-factories/' class='tag-link-195' title='11 topics' style='font-size: 8.5333333333333pt;'>Software Factories</a>
<a href='http://devhawk.net/tag/visual-studio/' class='tag-link-187' title='20 topics' style='font-size: 11.733333333333pt;'>Visual Studio</a>
<a href='http://devhawk.net/tag/washington-capitals/' class='tag-link-192' title='42 topics' style='font-size: 15.866666666667pt;'>Washington Capitals</a>
<a href='http://devhawk.net/tag/wcf/' class='tag-link-313' title='31 topics' style='font-size: 14.266666666667pt;'>WCF</a>
<a href='http://devhawk.net/tag/web-2-0/' class='tag-link-188' title='67 topics' style='font-size: 18.533333333333pt;'>Web 2.0</a>
<a href='http://devhawk.net/tag/web-services/' class='tag-link-290' title='12 topics' style='font-size: 8.9333333333333pt;'>Web Services</a>
<a href='http://devhawk.net/tag/wf/' class='tag-link-268' title='21 topics' style='font-size: 12pt;'>WF</a>
<a href='http://devhawk.net/tag/windows-live/' class='tag-link-207' title='29 topics' style='font-size: 13.866666666667pt;'>Windows Live</a>
<a href='http://devhawk.net/tag/working-at-msft/' class='tag-link-250' title='21 topics' style='font-size: 12pt;'>Working at MSFT</a>
<a href='http://devhawk.net/tag/xbox-360/' class='tag-link-189' title='54 topics' style='font-size: 17.333333333333pt;'>Xbox 360</a>
<a href='http://devhawk.net/tag/xml/' class='tag-link-238' title='11 topics' style='font-size: 8.5333333333333pt;'>XML</a>
<a href='http://devhawk.net/tag/xna/' class='tag-link-193' title='15 topics' style='font-size: 10.133333333333pt;'>XNA</a></div>
</aside>
                                        </div><!-- #left -->
      </div><!--.tc-sidebar -->

      
        </div><!--.row -->
    </div><!-- .container role: main -->

    
</div><!--#main-wrapper"-->

	<!-- FOOTER -->
	<footer id="footer" class="">
	 				<div class="container footer-widgets ">
				<div class="row widget-area" role="complementary">
					
					
													
							<div id="footer_one" class="span4">
								<aside id="meta-2" class="widget widget_meta"><h3 class="widget-title">Meta</h3>			<ul>
						<li><a href="http://devhawk.net/wp-login.php">Log in</a></li>
			<li><a href="http://devhawk.net/feed/" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://devhawk.net/comments/feed/" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>						</ul>
</aside>							</div>

						
					
													
							<div id="footer_two" class="span4">
								<aside id="text-6" class="widget widget_text"><h3 class="widget-title">Disclaimer</h3>			<div class="textwidget"><p>The information in this weblog is provided "AS IS" with no warranties, and confers no rights. This weblog does not represent the thoughts, intentions, plans or strategies of my employer. It is solely my opinion. Inappropriate comments will be deleted at the authors discretion.</p>

<script type='text/javascript'>
    function _dmBootstrap(file) { 
        var _dma = document.createElement('script');  
        _dma.type = 'text/javascript'; 
        _dma.async = true;  
        _dma.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + file; 
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(_dma);
    }
    function _dmFollowup(file) { if (typeof DMAds === 'undefined')  _dmBootstrap('cdn2.DeveloperMedia.com/a.min.js');}
    (function () { _dmBootstrap('cdn1.DeveloperMedia.com/a.min.js'); setTimeout(_dmFollowup, 2000);})();
</script>
</div>
		</aside>							</div>

						
					
						
									</div><!-- .row.widget-area -->
			</div><!--.footer-widgets -->
		    			 <div class="colophon">
		 	<div class="container">
		 		<div class="row-fluid">
				    <div class="span4 social-block pull-left"><a class="social-icon icon-feed" href="http://devhawk.net/feed/rss/" title="Suscribe to my rss feed"  ></a><a class="social-icon icon-twitter" href="http://twitter.com/devhawk" title="Follow me on Twitter" target=_blank ></a><a class="social-icon icon-facebook" href="http://facebook.com/devhawk" title="Follow me on Facebook" target=_blank ></a><a class="social-icon icon-github" href="http://github.com/devhawk" title="Follow me on Github" target=_blank ></a><a class="social-icon icon-linkedin" href="http://www.linkedin.com/in/harrypierson" title="Follow me on LinkedIn" target=_blank ></a></div><div class="span4 credits"><p> &middot; &copy; 2014 <a href="http://devhawk.net" title="DevHawk" rel="bookmark">DevHawk</a> &middot; Designed by <a href="http://www.themesandco.com/">Themes &amp; Co</a> &middot;</p></div><div class="span4 backtop"><p class="pull-right"><a class="back-to-top" href="#">Back to top</a></p></div>      			</div><!-- .row-fluid -->
      		</div><!-- .container -->
      	</div><!-- .colophon -->
    		</footer>
	
<!-- START: Syntax Highlighter ComPress -->
<script type="text/javascript">
    SyntaxHighlighter.autoloader(
        'applescript			http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushAppleScript.js',
        'actionscript3 as3		http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushAS3.js',
        'bash shell				http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushBash.js',
        'coldfusion cf			http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushColdFusion.js',
        'cpp c					http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushCpp.js',
        'c# c-sharp csharp		http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushCSharp.js',
        'css					http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushCss.js',
        'delphi pascal pas		http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushDelphi.js',
        'diff patch			    http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushDiff.js',
        'erl erlang				http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushErlang.js',
        'groovy					http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushGroovy.js',
        'java					http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushJava.js',
        'jfx javafx				http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushJavaFX.js',
        'js jscript javascript	http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushJScript.js',
        'perl pl				http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushPerl.js',
        'php					http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushPhp.js',
        'text plain				http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushPlain.js',
        'powershell ps          http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushPowerShell.js',
        'py python				http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushPython.js',
        'ruby rails ror rb		http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushRuby.js',
        'sass scss              http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushSass.js',
        'scala					http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushScala.js',
        'sql					http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushSql.js',
        'vb vbnet				http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushVb.js',
        'xml xhtml xslt html	http://devhawk.net/wp-content/plugins/syntax-highlighter-compress/scripts/shBrushXml.js'
    );
                        SyntaxHighlighter.defaults['tab-size'] = 4;
    SyntaxHighlighter.all();
</script>
<!-- END: Syntax Highlighter ComPress -->

		<div style="display:none">
	<div class="grofile-hash-map-67b5d13405bc2ba4ccba05d8a0e92c2b">
	</div>
	<div class="grofile-hash-map-56ec7ec88534583795e9086eaec1635b">
	</div>
	</div>
<script type='text/javascript' src='http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201415'></script>
<script type='text/javascript' src='http://s.gravatar.com/js/gprofiles.js?ver=2014Apraa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='http://devhawk.net/wp-content/plugins/jetpack/modules/wpgroho.js?ver=3.8.1'></script>
<script type='text/javascript' src='http://devhawk.net/wp-includes/js/jquery/ui/jquery.ui.core.min.js?ver=1.10.3'></script>
<script type='text/javascript' src='http://devhawk.net/wp-content/themes/customizr/inc/js/bootstrap.min.js'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var TCParams = {"FancyBoxState":"1","FancyBoxAutoscale":"1","SliderName":"","SliderDelay":"","SliderHover":"1","SmoothScroll":"linear"};
/* ]]> */
</script>
<script type='text/javascript' src='http://devhawk.net/wp-content/themes/customizr/inc/js/tc-scripts.min.js'></script>
<script type='text/javascript' src='http://devhawk.net/wp-content/themes/customizr/inc/js/holder.js'></script>
<script type='text/javascript' src='http://devhawk.net/wp-content/themes/customizr/inc/js/fancybox/jquery.fancybox-1.3.4.min.js'></script>
<script type='text/javascript' src='http://devhawk.net/wp-content/themes/customizr/inc/js/retina.min.js'></script>

	<script src="http://stats.wordpress.com/e-201415.js" type="text/javascript"></script>
	<script type="text/javascript">
	st_go({v:'ext',j:'1:2.9.2',blog:'22146351',post:'1165',tz:'-7'});
	var load_cmc = function(){linktracker_init(22146351,1165,2);};
	if ( typeof addLoadEvent != 'undefined' ) addLoadEvent(load_cmc);
	else load_cmc();
	</script>	</body>
</html>
