{"status":"ok","post":{"id":1270,"type":"post","slug":"syntax-highlighting-textboxes-in-wpf-a-sad-story","url":"http:\/\/devhawk.net\/2009\/07\/09\/syntax-highlighting-textboxes-in-wpf-a-sad-story\/","status":"publish","title":"Syntax Highlighting TextBoxes in WPF &#8211; A Sad Story","title_plain":"Syntax Highlighting TextBoxes in WPF &#8211; A Sad Story","content":"<p>One of the big new features in <a href=\"http:\/\/www.microsoft.com\/visualstudio\/en-us\/products\/2010\/default.mspx\">VS 2010<\/a> is the <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/dd885242(VS.100).aspx\">WPF based editor<\/a>. With it, you can build all sorts of cool stuff like <a href=\"http:\/\/blogs.msdn.com\/vseditor\/archive\/2009\/05\/13\/visualizing-xml-doc-comments.aspx\">control the visualization of XML doc comments<\/a>, <a href=\"http:\/\/editorsamples.codeplex.com\/Wiki\/View.aspx?title=IntelliSense%20Presenter\">change how intellisense looks<\/a>, even <a href=\"http:\/\/code.msdn.microsoft.com\/caretfisheye\">scale the size of text based on the location of the caret<\/a>. Huzzah for the WPF Visual Studio editor!<\/p>\n<p>However, as wicked awesome as the new editor is, AFAIK it\u2019s not going to be released as a separate component. So while the <a href=\"http:\/\/blogs.msdn.com\/powershell\/archive\/2008\/10\/31\/powershell-ise-and-visual-studio.aspx\">PowerShell<\/a>, <a href=\"http:\/\/blogs.msdn.com\/intellipad\/archive\/2009\/03\/25\/font-sizes-in-intellipad.aspx\">Intellipad<\/a> and other teams inside Microsoft can reuse the VS editor bits, nobody else can. So if you want to do something like <a href=\"http:\/\/www.iunknown.com\/2009\/05\/dynamic-languages-at-teched-2009.html\">embed a colorizing REPL in your WPF app<\/a>, you\u2019ll have to use something else.<\/p>\n<p>I\u2019ve <a href=\"http:\/\/devhawk.net\/2009\/02\/27\/Writing+An+IronPython+Debugger+MDbg+101.aspx\">thought about<\/a> putting a WPF based UI on top of ipydbg (though now I\u2019d probably use the new <a href=\"http:\/\/devhawk.net\/2009\/07\/08\/MicrosoftScriptingDebugging.aspx\">lightweight debugger<\/a> instead). So I downloaded <a href=\"http:\/\/github.com\/jflam\/repl-lib\/tree\/master\">John\u2019s repl-lib code<\/a> to see how he was doing it. Turns out his <a href=\"http:\/\/github.com\/jflam\/repl-lib\/blob\/5b597ab4b92a6d85f3e7f22d3ae9af271444b1d4\/Core\/Repl.xaml\">REPL control<\/a> is essentially a wrapper around WPF\u2019s <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/system.windows.controls.richtextbox.aspx\">RichTextBox control<\/a>. It works, but it seems kinda kludgy. For example, the RichTextBox supports bold, italics and underline hotkeys, so John\u2019s REPL does too. Though it is possible to <a href=\"http:\/\/blogs.msdn.com\/prajakta\/archive\/2006\/10\/12\/customize-richtextbox-to-allow-only-plain-text-input.aspx\">turn off these formatting commands<\/a>, I decided to take a look at modifying how the plain-old TextBox renders. After all, WPF controls are supposed to be <a href=\"http:\/\/www.drwpf.com\/blog\/Home\/tabid\/36\/EntryID\/53\/Default.aspx\">lookless<\/a>, right?<\/p>\n<p>Well, apparently not all the WPF controls are lookless. In particular to this post, the TextBox is definitely NOT lookless. It looks like the text editing capabilities of TextBox are provided by the Sys.Win.Documents.TextEditor class while the text rendering is provided by the Sys.Win.Controls.TextBoxView class. Both of those classes are internal, so don\u2019t even think about trying to customize or reuse them.<\/p>\n<p>The best (and I use that term loosely) way I found for customizing the TextBox rendering was a <a href=\"http:\/\/www.codeproject.com\/KB\/WPF\/CodeBox.aspx\">couple<\/a> of <a href=\"http:\/\/www.codeproject.com\/KB\/WPF\/CodeBox2.aspx\">articles<\/a> on CodeProject by <a href=\"http:\/\/www.codeproject.com\/Members\/KenJohnson\">Ken Johnson<\/a>. Ken\u2019s CodeBox control inherits from TextBox and sets the Foreground and Background to transparent (to hide the result of TextBoxView) and then overloads OnRender to render the text with colorization. Rendering the text twice \u2013 once transparently and once correctly \u2013 seems like a better solution than using the RichTextBox, but it\u2019s still pretty kludgy. (Note, I\u2019m calling the TextBox design kludgy \u2013 Ken\u2019s code is a pretty good work around).<\/p>\n<p>So if you want a colorized text box in WPF, your choices are:<\/p>\n<ul>\n<li>Build your own class that inherits from RichTextBox, disabling all the formatting commands and handling the TextChanged event to do colorization<\/li>\n<li>Build your own class that inherits from TextBox, but set Foreground an Background colors to transparent and overload OnRender to do the visible text rendering.<\/li>\n<li>Use a 3rd party control. The only one I found was the <a href=\"http:\/\/www.aqistar.com\">AqiStar TextBox<\/a>. No idea how good it is, but <a href=\"http:\/\/www.aqistar.com\/FeaturesVisualization.aspx\">they claim<\/a> to be a true lookless control. Any other syntax highlighting WPF controls around that I don\u2019t know about?<\/li>\n<\/ul>\n","excerpt":"<p>One of the big new features in VS 2010 is the WPF based editor. With it, you can build all sorts of cool stuff like control the visualization of XML doc comments, change how intellisense looks, even scale the size of text based on the location of the caret. Huzzah for the WPF Visual Studio [&hellip;]<\/p>\n","date":"2009-07-09 15:18:38","modified":"2011-04-17 20:46:18","categories":[{"id":204,"slug":"development","title":"Development","description":"","parent":0,"post_count":165}],"tags":[{"id":271,"slug":"wpf","title":"WPF","description":"","post_count":8}],"author":{"id":1,"slug":"admin","name":"DevHawk","first_name":"Harry","last_name":"Pierson","nickname":"DevHawk","url":"","description":""},"comments":[{"id":2225,"name":"Matthew Wilson","url":"http:\/\/diakopter.blogspot.com","date":"2009-07-09 15:49:08","content":"<p>Sorta related: my strategy for my Silverlight mimic of Intellipad is basically the same as Ken&#8217;s transparent overlay, except I&#8217;m writing my own RichTextBlock on top of TextBlock, and then FixedWidthRichTextBox on top of RichTextBlock (using the overlaid transparent TextBox for text selection and caret placement).<\/p>\n","parent":0},{"id":2226,"name":"Brad","url":"","date":"2009-07-09 16:54:27","content":"<p>Actipro have recently released a WPF SyntaxEditor:<br \/>\n<a href=\"http:\/\/www.actiprosoftware.com\/Products\/DotNet\/WPF\/SyntaxEditor\/Default.aspx\" rel=\"nofollow\">http:\/\/www.actiprosoftware.com\/Products\/DotNet\/WPF\/SyntaxEditor\/Default.aspx<\/a><\/p>\n","parent":0},{"id":2227,"name":"Jesse Ezell","url":"http:\/\/www.iserviceoriented.com","date":"2009-07-10 09:53:27","content":"<p>Microsoft is great at providing frameworks, but horrible at providing tools for their frameworks. For example, WCF has almost zero quality tools from MS to work with. The WF editor blows goats. They are trying to foster all this language development with M and the DLR and the .NET framework itself, yet they don&#8217;t make it easy for anyone to do anything other than build a language. If you actually want to build your own tools that don&#8217;t ship inside of VS, all you will get is a big fuck you. The Java community is light years ahead on this front&#8230;<\/p>\n","parent":0},{"id":2228,"name":"Mark","url":"","date":"2009-07-10 16:52:12","content":"<p>SharpDevelop has a WPF based editor called AvalonEdit.<\/p>\n<p><a href=\"http:\/\/wiki.sharpdevelop.net\/Default.aspx?Page=AvalonEdit&#038;AspxAutoDetectCookieSupport=1\" rel=\"nofollow\">http:\/\/wiki.sharpdevelop.net\/Default.aspx?Page=AvalonEdit&#038;AspxAutoDetectCookieSupport=1<\/a><\/p>\n<p>Its still in development but the source is available from subversion and it was pretty easy to get built and working, including python highlighting.  I have a basic Python console working using and and so far it is working very well.<\/p>\n","parent":0},{"id":2229,"name":"jeff","url":"","date":"2009-07-13 14:53:09","content":"<p>Actipro has a WPF based Syntax editor.  We are looking at it for simple Python scripts.<\/p>\n","parent":0},{"id":2230,"name":"DevHawk","url":"","date":"2009-07-14 22:17:03","content":"<p>Mark, my understanding is that SharpDevelop is GPL licensed. Is AvalonEdit also GPL?<\/p>\n","parent":0}],"attachments":[],"comment_count":6,"comment_status":"closed","custom_fields":{"dasblog_entryid":["d1f69023-194b-4721-9293-855f6143b6de"],"dasblog_compressedtitle":["Syntax+Highlighting+TextBoxes+In+WPF+Ndash+A+Sad+Story"],"dasblog_compressedtitleunique":["2009\/07\/09\/Syntax+Highlighting+TextBoxes+In+WPF+Ndash+A+Sad+Story"]}},"previous_url":"http:\/\/devhawk.net\/2009\/07\/08\/microsoft-scripting-debugging\/","next_url":"http:\/\/devhawk.net\/2009\/07\/13\/probably-wrong-info-is-worse-than-no-info-at-all\/"}