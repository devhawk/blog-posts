<p>So as a quick break from all this architecture talk, I&#8217;ve got a code smell question. Here&#8217;s a scenario, I&#8217;m interested in feedback on the best way to solve the issue.</p>
<p>I&#8217;m writing some VSTO code for Word using VS05. I want to be able to add and update custom properties on the document. You do this via the CustomDocumentProperties property off the document object. This DocumentProperties collection supports the standard collection type operations such as Add and an indexer. However, it&#8217;s a little exception happy. If you attempt to access a property that doesn&#8217;t exist, it throws an exception. And if you attempt to add a property that already exists, it throws an exception. So the first time you set a custom property you use the Add method and then after that you use the indexer to access the existing item in the collection and update it&#8217;s value. </p>
<p>Of course, the way my code is written, I want to hide this ugliness behind a method so that the rest of my code can simply set custom properties with ease. However, I want to use the same method regardless if the item already exists in the collection. So what&#8217;s the best way to implement the method? I can think of two primary ways.</p>
<ol>
<li>Attempt to access the custom property via the indexer. If it throws an exception, trap it and call Add instead.</li>
<li>Manually iterate through the existing custom properties. If the property exists, update it directly. If it doesn&#8217;t, call Add instead.</li>
</ol>
<p>Neither of these is particularly fragrant from a code smell perspective, but which is less odorous? The first one is more direct to write, but since this is all COM interop code, the COM exception is pretty generic. Theoretically, if something else caused an exception to be thrown, I&#8217;d still assume the custom property was just missing and swallow the exception, potentially causing an error somewhere else. However, writing the code to manually iterate through the collection just seems excessive. </p>
<p>In the end, I went with #2 as I was more worried about swallowing exceptions than manual iterating though the collection. What do you think? Was that the right choice?</p>
