{"status":"ok","post":{"id":2093,"type":"post","slug":"brokered-winrt-components-step-two","url":"http:\/\/devhawk.net\/2014\/04\/25\/brokered-winrt-components-step-two\/","status":"publish","title":"Brokered WinRT Components Step Two","title_plain":"Brokered WinRT Components Step Two","content":"<p>Now that we have built the brokered component , we have to build a proxy\/stub for it. Proxies and stubs are how WinRT method calls are marshalled across process boundaries. If you want to know more \u2013 or you have insomnia \u2013 feel free to read <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/windows\/desktop\/ms692621(v=vs.85).aspx\">all the gory details up on MSDN<\/a>.<\/p>\n<p>Proxies and stubs look like they might be scary, but they\u2019re actually trivial (at least in the brokered component scenario) because 100% of the code is generated for you. It couldn\u2019t be much easier.<\/p>\n<p>Right click the solution node and select Add -&gt; New Project. Alternatively, you can select File -&gt; New -&gt; Project in the Visual Studio main menu, but if you do that make sure you change the default solution from \u201cCreate new Solution\u201d to \u201cAdd to Solution\u201d. Regardless of how you launch the new project wizard, search for \u201cbroker\u201d again, but this time select the \u201cBrokered Windows Runtime ProxyStub\u201d template. Give the project a name &#8211; I chose \u201cHelloWorldBRT.PS\u201d.<\/p>\n<p><a href=\"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubAddReference.png\" class=\"grouped_elements\" rel=\"tc-fancybox-group2093\"><img class=\"alignleft  wp-image-2099\" alt=\"ProxyStubAddReference\" src=\"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubAddReference-300x174.png\" width=\"180\" height=\"104\" \/><\/a>Once you\u2019ve created the proxy\/stub project, you need to set a reference to the brokered component you created in step 1. Since proxies and stubs are native, this is a VC++ project. Adding a reference in a VC++ is not as straightforward as it is in C# projects. Right click the proxy\/stub project, select \u201cProperties\u201d and then select Common Properties -&gt; References from the tree on the left. Press the \u201cAdd New Reference\u2026\u201d button to bring up the same Add Reference dialog you\u2019ve seen in managed code projects. Select the brokered component project and press OK.<\/p>\n<p>Remember when I said that 100% of the code for the proxy\/stub is generated? I wasn\u2019t kidding \u2013 creating the template and setting referencing the brokered component project is literally all you need to do. Want proof? Go ahead and build now. If you watch the output windows, you\u2019ll see a bunch of output go by referencing IDL files and MIDLRT among other stuff. This proxy\/stub template has some custom MSBuild tasks that generates the proxy\/stub code using winmdidl and midlrt. The process is similar to what is <a href=\"http:\/\/msdn.microsoft.com\/en-us\/library\/dn481253.aspx\">described here<\/a>. BTW, if you get a chance, check out the proxy\/stub project file \u2013 it is a work of art. Major props to <a href=\"http:\/\/www.linkedin.com\/pub\/kieran-mockford\/4\/77\/110\">Kieran Mockford<\/a> for his msbuild wizardry.<\/p>\n<p><a href=\"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubRegisterOutput.png\" class=\"grouped_elements\" rel=\"tc-fancybox-group2093\"><img class=\"alignright  wp-image-2100\" alt=\"ProxyStubRegisterOutput\" src=\"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubRegisterOutput-300x174.png\" width=\"180\" height=\"104\" \/><\/a>Unfortunately, it\u2019s not enough just to build the proxy\/stub \u2013 you also have to register it. The brokered component proxy\/stub needs to be registered globally on the machine, which means you have to be running as an admin to do it. VS can register the proxy\/stub for you automatically, but that means you have to run VS as an administrator. That always makes me nervous, but if you\u2019re OK with running as admin you can enable proxy\/stub registration by right clicking the proxy\/stub project file, selecting Properties, navigating to Configuration properties -&gt; Linker -&gt; General in the tree of the project properties page, and then changing Register Output to \u201cYes\u201d.<\/p>\n<p>If you don\u2019t like running VS as admin, you can manually register the proxy\/stub by running \u201cregsvr32 &lt;proxystub dll&gt;\u201d from an elevated command prompt. Note, you do have to re-register every time the public surface area of your brokered component changes so letting VS handle registration admin is definitely the easier route to go.<\/p>\n<p>In the <a href=\"http:\/\/devhawk.net\/2014\/04\/25\/brokered-winrt-components-step-three\">third and final step<\/a>, we&#8217;ll\u00a0build a client app that accesses our brokered component.<\/p>\n","excerpt":"<p>Now that we have built the brokered component , we have to build a proxy\/stub for it. Proxies and stubs are how WinRT method calls are marshalled across process boundaries. If you want to know more \u2013 or you have insomnia \u2013 feel free to read all the gory details up on MSDN. Proxies and [&hellip;]<\/p>\n","date":"2014-04-25 08:43:35","modified":"2014-04-25 08:45:13","categories":[{"id":204,"slug":"development","title":"Development","description":"","parent":0,"post_count":165},{"id":283,"slug":"windows","title":"Windows","description":"","parent":0,"post_count":16},{"id":357,"slug":"windows-runtime","title":"Windows Runtime","description":"","parent":0,"post_count":12}],"tags":[{"id":374,"slug":"brokered-components","title":"brokered components","description":"","post_count":6},{"id":373,"slug":"sideload","title":"sideload","description":"","post_count":6},{"id":378,"slug":"tutorial","title":"tutorial","description":"","post_count":4}],"author":{"id":1,"slug":"admin","name":"DevHawk","first_name":"Harry","last_name":"Pierson","nickname":"DevHawk","url":"","description":""},"comments":[],"attachments":[{"id":2099,"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubAddReference.png","slug":"proxystubaddreference","title":"ProxyStubAddReference","description":"","caption":"","parent":2093,"mime_type":"image\/png","images":{"full":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubAddReference.png","width":766,"height":445},"thumbnail":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubAddReference-150x150.png","width":150,"height":150},"medium":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubAddReference-300x174.png","width":300,"height":174},"large":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubAddReference.png","width":766,"height":445},"tc-thumb":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubAddReference-270x250.png","width":270,"height":250},"slider-full":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubAddReference.png","width":766,"height":445},"slider":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubAddReference.png","width":766,"height":445}}},{"id":2100,"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubRegisterOutput.png","slug":"proxystubregisteroutput","title":"ProxyStubRegisterOutput","description":"","caption":"","parent":2093,"mime_type":"image\/png","images":{"full":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubRegisterOutput.png","width":766,"height":445},"thumbnail":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubRegisterOutput-150x150.png","width":150,"height":150},"medium":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubRegisterOutput-300x174.png","width":300,"height":174},"large":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubRegisterOutput.png","width":766,"height":445},"tc-thumb":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubRegisterOutput-270x250.png","width":270,"height":250},"slider-full":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubRegisterOutput.png","width":766,"height":445},"slider":{"url":"http:\/\/devhawk.net\/wp-content\/uploads\/2014\/04\/ProxyStubRegisterOutput.png","width":766,"height":445}}}],"comment_count":0,"comment_status":"closed","custom_fields":{"layout_key":[""],"post_slider_check_key":["0"]}},"previous_url":"http:\/\/devhawk.net\/2014\/04\/25\/brokered-winrt-components-step-one\/","next_url":"http:\/\/devhawk.net\/2014\/04\/25\/brokered-winrt-components-step-three\/"}