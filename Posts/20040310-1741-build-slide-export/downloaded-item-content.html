<div>I <a href="http://devhawk.net/PermaLink.aspx?guid=903afb72-e67e-4592-b631-0a9edb383bfe">blogged</a> yesterday about the issues I&#8217;m having with manually repurposing content. One of the specific issues has to do with the <a href="http://msdn.microsoft.com/architecture/overview/series/">Architecture Strategy Series</a>. We provide that content via three channels &#8211; DVD, online seminars and (soon) download. We use <a href="http://www.microsoft.com/office/powerpoint/producer/prodinfo/default.mspx">Producer</a> to create the DVD and download files. However, online seminar system doesn&#8217;t support Producer. The primary issue is that Producer uses the Save as HTML version of the PPT, but the online seminar system only supports static images. This means having to manually strip out the animations, which is a pain in the ass. Since I don&#8217;t ever want to have to do that again, I wrote a PowerPoint add-in to do it for me.</div>
<div>When you invoke the <a href="http://cid-0d9bc809858885a4.office.live.com/self.aspx/DevHawk%20Content/BlogFiles/BuildSlideExport.msi">Build Slide Export add-in</a> , it will step thru your presentation and screen capture each slide build to disk. It&#8217;s very similar to the built in Save as JPEG/GIF/PNG feature, except that it creates an image per build, not per slide. So those complex build slides turn out multiple image files. It&#8217;s sort that you can&#8217;t use the machine for anything else while it&#8217;s processing, but it was really easy to write the code. I tested it on a long complex PPT file with lots of builds (i.e. the one that took me hours to repurpose on Monday) and it took about 10 minutes.</div>
<div>I&#8217;m also providing the <a href="http://cid-0d9bc809858885a4.office.live.com/self.aspx/DevHawk%20Content/BlogFiles/BuildSlideExport Source.zip">source</a> to the add-in. It&#8217;s not much code: maybe 150 lines of relevant code at most. I grabbed the screen capture code from <a href="http://www.c-sharpcorner.com/Code/2003/Dec/ScreenCapture.asp">Perry Lee on C# Corner</a>.</div>
<div>There were a couple of gotchas involved with this add-in. For example, the add-in project type uses version 7.0 of the office.dll that comes with VS.NET. However, Office 2003 comes with version 11.0 of that DLL and not 7.0, so the first time I went to deploy on my production machine, it didn&#8217;t work. I had to grab the right version of office.dll out of the GAC in order to reference it, so it&#8217;s included in the lib directory of the source archive (it looks like <a href="http://www.simonguest.com/">Simon</a> did something similar with <a href="http://workspaces.gotdotnet.com/niobe">Niobe</a>). Also, PowerPoint&#8217;s object model is a little funky. Specifically, SlideShowView.Next() has to be called differently depending on the types of builds in the slides. I handle four different scenarios in the code: no builds, only auto trigger builds, and manual trigger builds, optionally with a set of auto trigger builds before the first manual trigger build.</div>
<div>I&#8217;m sure there&#8217;s other enhancements that could be made &#8211; for example, the directory the images are saved isn&#8217;t selectable nor is the image format. If there&#8217;s any interest, I&#8217;ll spin up a GDN workspace.</div>
<div><strong>Update</strong>: I just noticed a bug, albiet a cut-and-paste bug on my part. Turns out the <a href="http://www.c-sharpcorner.com/Code/2003/Dec/ScreenCapture.asp">screen capture code</a> that I used is creating four&nbsp;image objects for each screen capture. To make matters worse, three of them are never assigned to a variable, so you can&#8217;t call Dispose() on them. So for any real-sized presenation, memory usage goes thru the roof. It&#8217;s relatively easy to fix. Take the code that looks like this:</div>
<div>
<pre class="brush:csharp">Bitmap image = new Bitmap(
&nbsp;   Image.FromHbitmap(new IntPtr(hBitmap)),
&nbsp;   Image.FromHbitmap(new IntPtr(hBitmap)).Width,
&nbsp;   Image.FromHbitmap(new IntPtr(hBitmap)).Height);
image.Save(fileName,imageFormat);</pre>
</div>
<div dir="ltr">And replace it with this:</div>
<div dir="ltr">
<pre class="brush:csharp">Bitmap image = Image.FromHbitmap(new IntPtr(hBitmap));
image.Save(fileName,imageFormat);image.Dispose();</pre>
</div>
<div dir="ltr">With the improved code, only one bitmap per screen capture is made, and it&#8217;s explicitly disposed. That keeps memory usage under control.</div>
<div dir="ltr"><strong>Another Update</strong>: I&#8217;ve updated the binary and the code links above with the new v1.0.1 version that fixes the memory hogging problem.</div>
