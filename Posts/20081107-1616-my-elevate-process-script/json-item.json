{"status":"ok","post":{"id":1185,"type":"post","slug":"my-elevate-process-script","url":"http:\/\/devhawk.net\/2008\/11\/07\/my-elevate-process-script\/","status":"publish","title":"My Elevate-Process Script","title_plain":"My Elevate-Process Script","content":"<p>I used to use the <a href=\"http:\/\/technet.microsoft.com\/en-us\/magazine\/cc162321.aspx\">Script Elevation PowerToys<\/a> to provide a simple way to launch an elevated command window from a Powershell prompt. However, that required installing said PowerToys in order to work, which I invariably forgot to install when paving my machine. That got annoying, so I went in search of a pure Powershell solution, which <a href=\"http:\/\/www.peterprovost.org\/blog\/post\/Powershell-Sudo-(sort-of)-for-Vista-UAC-REDUX.aspx\">Peter Provost conveniently provided<\/a> on his blog. <\/p>\n<p>However, one of the benefits of the Script Elevation PowerToys was the ability to launch an admin command prompt in a specific directory \u2013 including the current one. I wanted the ability to default to launching Powershell when the user doesn\u2019t specify a command to run. I thought I could just set $psi.WorkingDirectory, but as I\u2019ve <a href=\"http:\/\/devhawk.net\/2008\/07\/28\/DevHawks+Slightly+Useful+Powershell+Configuration.aspx\">described previously<\/a>, I update $home in my profile script to D:HPierson.Files (I keep my important files on my D: drive so I can pave C: with impunity) then set my current location to $home. So I can\u2019t set the current location by using $psi.WorkingDirectory \u2013 it just gets overridden by my profile script.<\/p>\n<p>However, it turns out you can pass arbitrary script code to Powershell via the \u2013Command arguments. You also have to pass \u2013NoExit to keep the command window around. The script passed in via -Command is executed after the profile script, so I can pass in a little script code to set the current location to the right location. <\/p>\n<p>I modified Peter\u2019s elevate-process script to launch a new Powershell command window when zero arguments or one folder argument are passed in. In those cases, elevate-process sets the location to the specified directory (current directory as the default when no arguments are provided) via the \u2013NoExit and \u2013Command arguments.<\/p>\n<p>I\u2019ve <a href=\"http:\/\/cid-0d9bc809858885a4.skydrive.live.com\/self.aspx\/DevHawk%20Content\/Powershell\/elevate-process.ps1\">posted the script<\/a> to my SkyDrive as well as providing it below. Feel free to <strike>steal<\/strike> use it as you need. <\/p>\n<pre class=\"brush: powershell\">\nfunction elevate-process  \n{  \n  $psi = new-object System.Diagnostics.ProcessStartInfo     \n  $psi.Verb = \"runas\";     \n\n  #if we pass no parameters, then launch PowerShell in the current location\n  if ($args.length -eq 0)     \n  {     \n    $psi.FileName = 'powershell'\n    $psi.Arguments =  \n      \"-NoExit -Command &amp;{set-location '\" + (get-location).Path + \"'}\"\n  }     \n\n  #if we pass in a folder location, then launch powershell in that location\n  elseif (($args.Length -eq 1) -and  \n          (test-path $args[0] -pathType Container))     \n  {     \n    $psi.FileName = 'powershell'\n    $psi.Arguments =  \n        \"-NoExit -Command &amp;{set-location '\" + (resolve-path $args[0]) + \"'}\"\n  }     \n\n  #otherwise, launch the application specified in the arguments\n  else\n  {     \n    $file, [string]$arguments = $args;     \n    $psi.FileName = $file   \n    $psi.Arguments = $arguments\n  }     \n     \n  [System.Diagnostics.Process]::Start($psi) | out-null\n}\n<\/pre>\n<p><strong><u>Update<\/u><\/strong>: I tried to run my elevate-process script from c:Program Files and discovered a bug. The set-location scripts need the path parameter to be encapsulated in single quotes in order to handle paths with spaces. I\u2019ve updated both the code above as well as the copy on my SkyDrive.<\/p>\n","excerpt":"<p>I used to use the Script Elevation PowerToys to provide a simple way to launch an elevated command window from a Powershell prompt. However, that required installing said PowerToys in order to work, which I invariably forgot to install when paving my machine. That got annoying, so I went in search of a pure Powershell [&hellip;]<\/p>\n","date":"2008-11-07 16:16:40","modified":"2008-11-07 16:16:40","categories":[],"tags":[{"id":230,"slug":"powershell","title":"PowerShell","description":"","post_count":41}],"author":{"id":1,"slug":"admin","name":"DevHawk","first_name":"Harry","last_name":"Pierson","nickname":"DevHawk","url":"","description":""},"comments":[],"attachments":[],"comment_count":0,"comment_status":"closed","custom_fields":{"dasblog_entryid":["044cf2d4-cc92-4d0d-8b5e-2b5d15a29982"],"dasblog_compressedtitle":["My+ElevateProcess+Script"],"dasblog_compressedtitleunique":["2008\/11\/08\/My+ElevateProcess+Script"]}},"previous_url":"http:\/\/devhawk.net\/2008\/11\/05\/election-predictions\/","next_url":"http:\/\/devhawk.net\/2008\/11\/10\/my-change-gov-idea\/"}