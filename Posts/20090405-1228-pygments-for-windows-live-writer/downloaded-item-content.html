<p>For the past few years, I&#8217;ve used the <a href="http://codehtmler.codeplex.com/">CodeHTMLer plugin</a> for Windows Live Writer for the code snippets in my blog. However, recently I discovered the <a href="http://pygments.org/">Pygments</a> Python syntax highlighter package which supports scores more languages than CodeHTMLer does. It also support multiple color schemes and was easily extensible so I could build an HTML formatter that didn&#8217;t use &lt;pre&gt; tags (which <a href="http://devhawk.net/2007/12/07/Blogging+F+Code.aspx">I&#8217;ve found DasBlog has issues with</a> in the RSS feed, though honestly I&#8217;m running three minor releases behind the latest DasBlog release). IronPython supports Pygments just fine &#8211; at least, the one IPy bug that Pygments exposes has a simple workaround &#8211; so I set about building a Windows Live Writer plugin that uses it.</p>
<p>If you&#8217;re simply interested in the plugin itself, you can <a href="http://cid-0d9bc809858885a4.skydrive.live.com/self.aspx/DevHawk%20Content/Pygments%20for%20WL%20Writer/Pygments.WLWriter.msi">get it from my skydrive</a>. The <a href="http://github.com/devhawk/pygments.wlwriter">source is up on GitHub</a>. For now, if you find any bugs, please leave a comment on this post. If there&#8217;s enough interest I&#8217;ll setup a site somewhere (CodePlex perhaps) where I can track bugs and feature requests.</p>
<p>Pygments for WL Writer is a <a href="http://msdn.microsoft.com/en-us/library/aa702799.aspx">smart content source</a>. In WL Writer&#8217;s terminology, that means when you click inserted text in the editor window, it is treated as an atomic entity which you can then edit by using the Edit Code button in the Pygments for WL Writer sidebar editor. I I often found that I would edit my code multiple times &#8211; usually to shorten lines so they&#8217;d fit on my blog without wrapping. CodeHTMLer for WL Writer is a standard content source, so it just spews the formatted code as HTML onto the page.</p>
<p>From an IronPython perspective, there&#8217;s some interesting stuff there. I decided to compile the pygments library into a DLL for easier distribution. If you look in the source, there&#8217;s a <a href="http://github.com/devhawk/pygments.wlwriter/tree/5684d8e936921e9f79ab3e3f08bd1570e48a8a51/pygments_package">folder</a> for the Pygments source as well as the <a href="http://github.com/devhawk/pygments.wlwriter/tree/5684d8e936921e9f79ab3e3f08bd1570e48a8a51/pygments_package/pygments_dependencies">parts of the standard Python library</a> that Pygments depends on and my <a href="http://github.com/devhawk/pygments.wlwriter/blob/5684d8e936921e9f79ab3e3f08bd1570e48a8a51/pygments_package/devhawk_formatter.py">custom HTML formatter</a>. Those all get compiled <a href="http://github.com/devhawk/pygments.wlwriter/blob/5684d8e936921e9f79ab3e3f08bd1570e48a8a51/pygments_package/build_pygments.py">via a custom script</a> which can be called by the <a href="http://github.com/devhawk/pygments.wlwriter/blob/5684d8e936921e9f79ab3e3f08bd1570e48a8a51/build.bat">build.bat file</a> in the project root. </p>
<p>Some features I&#8217;m thinking about adding:</p>
<ul>
<li>An extensibility model so that you can add new languages by dropping new <a href="http://pygments.org/docs/lexerdevelopment/">Pygments lexers</a> into the same folder the plugin is installed to. Pygments supports lots of languages, but not all of them &#8211; notably it&#8217;s missing Powershell and F#. </li>
<li>Support for new HTML formatters and color schemes using the same extensibility mechanism described above.</li>
<li>Support for selecting an HTML formatter.</li>
<li>Improving the code editor window. Currently, I&#8217;m using a standard WinForms multi-line TextBox, but that leaves a lot to be desired. With the Python work I do, I often need to be able to select a bunch of text and change it&#8217;s indenting via tab and shift-tab. If anyone has a suggestion for a good WinForms text editing control, <a href="mailto:harry@devhawk.net">let me know</a>.</li>
<li>Being able to specify the font and size of the Pygmented code.</li>
<li>Storing user preferences &#8211; remembering the most recent syntax and color scheme the user used.</li>
</ul>
<p>Feedback, as always is appreciated. I&#8217;ll probably write a few posts about the project when I get a chance, so let me know if there&#8217;s anything you&#8217;re dying to hear about.</p>
