<p>Now that I have my <a href="http://devhawk.net/2008/11/27/IronPython+And+Linq+To+XML+Part+2+Screen+Scraping.aspx">list of Rock Band songs</a> and I can <a href="http://devhawk.net/2008/11/27/IronPython+And+Linq+To+XML+Part+3+Consuming+Atom+Feeds.aspx">get the right Zune metadata</a> for most of them, I just need to write out the playlist XML. This is very straight forward to do with the classes in System.Xml.Linq.</p>
<pre class="brush: python">def GenMediaElement(song):
  try:
    trackurl = zune_catalog_url + song.search_string     
    trackfeed = XDocument.Load(trackurl)
    trackentry = First(trackfeed.Descendants(atomns+'entry'))
    trk = ScrapeEntry(trackentry)
    return XElement('media', (XAttribute(key, trk[key]) for key in trk))
  except:
    print &quot;FAILED&quot;, song     
     
zpl = XElement(&quot;smil&quot;,     
  XElement(&quot;head&quot;,  
    XElement(&quot;title&quot;, &quot;Rock Band Generated Playlist&quot;)),     
  XElement(&quot;body&quot;,     
    XElement(&quot;seq&quot;, (GenMediaElement(song) for song in songs))))

settings = XmlWriterSettings()
settings.Indent = True     
settings.Encoding = Encoding.UTF8     
with XmlWriter.Create(&quot;rockband.zpl&quot;, settings) as xtw:
  zpl.WriteTo(xtw)
</pre>
<p></p>
<p>XElement&#8217;s <a href="http://msdn.microsoft.com/en-us/library/bb302741.aspx">constructor</a> takes a name (<a href="http://msdn.microsoft.com/en-us/library/system.xml.linq.xname.aspx">XName</a> to be precise) and any number of <a href="http://msdn.microsoft.com/en-us/library/bb943882.aspx">child objects</a>. These child objects can be XML nodes (aka <a href="http://msdn.microsoft.com/en-us/library/system.xml.linq.xobject.aspx">XObjects</a>) or simple content objects like strings or numbers. If you pass an IEnumerable, the XElement constructor will iterate the collection and add all the items as children of the element. If you&#8217;ve had the displeasure of building an XML tree using the <a href="http://www.w3.org/DOM/">DOM</a>, you&#8217;ll really appreciate XElements&#8217;s fluent interface. I was worried that Python&#8217;s significant whitespace would force me to put all the nested XElements on a single line, but luckily Python doesn&#8217;t treat whitespace inside parenthesis as significant.&nbsp; </p>
<p>Creating collections in Python is even easier than it is in C#. Python&#8217;s supports a <a href="http://www.python.org/doc/2.5.2/ref/yield.html">yield keyword</a> which is basically the equivalent of C#&#8217;s <a href="http://msdn.microsoft.com/en-us/library/9k7k7cf0(VS.80).aspx">yield return</a>. However, Python also supports list comprehensions (known as <a href="http://www.python.org/doc/2.5.2/ref/genexpr.html">generator expressions</a>), which are similar to <a href="http://research.microsoft.com/fsharp/manual/lexyacc.aspx#_Toc207785615">F#&#8217;s sequence expressions</a>. These are nice because you can specify a collection in a single line, rather than having to create a separate function, which is what you have to do to use yield. I have two generator expressions: (XAttribute(key, trk[key]) for key in trk) creates a collection of XAttributes, one for every item in the trk dictionary and (GenMediaElement(song) for song in songs) which generates a collection of XElements, one for every song in the song collection.</p>
<p>Once I&#8217;ve finished building the playlist XML, I need to write it out to a file. Originally, I used Python&#8217;s built in open function, but the playlist file had to be UTF-8 because of band names like M&#246;tley Cr&#252;e. Zune&#8217;s software appears to always use UTF-8. In addition to setting the encoding, I also specify to use indentation, so the resulting file is somewhat readable by humans.</p>
<p>The playlist works great in the Zune software, but since it&#8217;s a <a href="http://www.mjefferson.net/2008/04/03/zune-streaming-playlists/">streaming playlist</a> there&#8217;s no easy way to automatically download all the songs and sync them to your Zune device. I expected to be able to right click on the playlist and select &#8220;download all&#8221;, but there&#8217;s no such option. Zune does have a concept called <a href="http://www.zune.net/NR/rdonlyres/51AE197B-221B-4192-AC4A-7CA1CBFC8312/0/channels.wmv">Channels</a> where the songs from a regularly updated feed are downloaded locally and synced to the device. However, the Zune software appears to be hardcoded to only download channels from the catalog service so I couldn&#8217;t tap into that. If anyone knows how to sign up to become a Zune partner channel, please drop me a line. </p>
<p>Otherwise, that&#8217;s So there you have it. As usual, I&#8217;ve stuck the code <a href="http://cid-0d9bc809858885a4.skydrive.live.com/self.aspx/DevHawk%20Content/IronPython%20Stuff/RockBandZunePass.zip">up on my SkyDrive</a>. If I can remember, I&#8217;ll try and run the script once a week and upload <a href="http://cid-0d9bc809858885a4.skydrive.live.com/self.aspx/DevHawk%20Content/Zune/rockband.zpl">the new playlist</a> to my SkyDrive as well. </p>
